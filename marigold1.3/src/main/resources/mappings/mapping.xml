<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ShoesDAO">

	<select id="getList" resultType="shoes">
		SELECT * FROM shoess
	</select>
	
	<select id="getOne" resultType="shoes">
		SELECT * FROM shoess
			where firstCategory = #{firstCategory}
				and secondCategory = #{secondCategory}
				and thirdCategory = #{thirdCategory}
				and fourthCategory = #{fourthCategory}
				and brand = #{brand}
	</select>
	
	<select id="getCheckList" resultType="shoes">
		SELECT * FROM SHOESS 
			<where>
				firstCategory = #{firstCategory} AND SECONDCATEGORY = #{secondCategory} 
				<if test="thirdCategory != null">
					and thirdCategory in
					<foreach collection="thirdCategory" item="thirdCategory" index="index" open="(" close=")" separator=",">
						'${thirdCategory}'
					</foreach>
				</if>
				<if test="fourthCategory != null">
					and fourthCategory in
					<foreach collection="fourthCategory" item="fourthCategory" index="index" open="(" close=")" separator=",">
						'${fourthCategory}'
					</foreach>
				</if>
				<if test="brand != null">
					and brand in
					<foreach collection="brand" item="brand" index="index" open="(" close=")" separator=",">
						'${brand}'
					</foreach>
				</if>

				<if test="color != null">
					and color in
					<foreach collection="color" item="color" index="index" open="(" close=")" separator=",">
						'${color}'
					</foreach>
				</if>
				<if test="material != null">
					and material in
					<foreach collection="material" item="material" index="index" open="(" close=")" separator=",">
						'${material}'
					</foreach>
				</if>

				<if test="price != null">
					and
					<foreach collection="price" item="price" index="index" open="(" close=")" separator="or">
						<if test="price == 1">
							<![CDATA[(price < 50000)]]>
						</if>
						<if test="price == 2">
							<![CDATA[(50000 <= price and price < 100000)]]>
						</if>
						<if test="price == 3">
							<![CDATA[(100000 <= price and price < 300000)]]>
						</if>
						<if test="price == 4">
							<![CDATA[(300000 <= price and price < 500000)]]>
						</if>
						<if test="price == 5">
							<![CDATA[(500000 <= price)]]>
						</if>
					</foreach>
				</if>
			</where>
	</select>
<!--
	<select id="getSearchList" resultType="shoes" parameterType="HashMap">
		SELECT distinct s.* FROM shoess s, firstCategory fc, secondCategory sc, thirdCategory tc, fourthCategory ftc
		<where>
			<if test="searchKeyword != null">
				<foreach collection="searchKeyword" item="searchKeyword" index="index" open="(" close=")" separator="and">
					(s.FIRSTCATEGORY = initCap(fc.FIRSTCATEGORY) and (fc.FIRSTCATEGORYCON like '%'||#{searchKeyword}||'%' or fc.FIRSTCATEGORYSIM like '%'||#{searchKeyword}||'%'))
						or (s.SECONDCATEGORY = initCap(sc.SECONDCATEGORY) and (sc.SECONDCATEGORYCon like '%'||#{searchKeyword}||'%'))
						or (s.THIRDCATEGORY = tc.THIRDCATEGORY and (tc.THIRDCATEGORYYCON like '%'||#{searchKeyword}||'%'))
						or (s.FOURTHCATEGORY = ftc.FOURTHCATEGORY and (ftc.FOURTHCATEGORYCON like '%'||#{searchKeyword}||'%'))
						or (BRAND like initCap('%'||#{searchKeyword}||'%'))
						or (SPECIALDAY like '%'||#{searchKeyword}||'%')
						or (COLOR like initCap('%'||#{searchKeyword}||'%'))
						or (MATERIAL like initCap('%'||#{searchKeyword}||'%'))
						or (PRICE like initCap('%'||#{searchKeyword}||'%'))
						or (HEEL like initCap('%'||#{searchKeyword}||'%'))
						or (MODELID like initCap('%'||#{searchKeyword}||'%'))
				</foreach>
			</if>
		</where>
	</select>
-->	
	<select id="getSearchList" resultType="shoes" parameterType="HashMap">
		<if test="searchKeyword != null">
			<foreach collection="searchKeyword" item="searchKeyword" index="index" open="(" close=")" separator="intersect">
				SELECT distinct s.* FROM shoess s, firstCategory fc, secondCategory sc, thirdCategory tc, fourthCategory ftc, brand b
					where
						(s.FIRSTCATEGORY = initCap(fc.FIRSTCATEGORY) and (fc.FIRSTCATEGORYCON like '%'||#{searchKeyword}||'%' or fc.FIRSTCATEGORYSIM like '%'||#{searchKeyword}||'%'))
							or (s.SECONDCATEGORY = initCap(sc.SECONDCATEGORY) and (sc.SECONDCATEGORYCon like '%'||#{searchKeyword}||'%'))
							or (s.THIRDCATEGORY = tc.THIRDCATEGORY and (tc.THIRDCATEGORYYCON like '%'||#{searchKeyword}||'%'))
							or (s.FOURTHCATEGORY = ftc.FOURTHCATEGORY and (ftc.FOURTHCATEGORYCON like '%'||#{searchKeyword}||'%'))
							or (s.BRAND = b.BRAND and (BRANDCON like initCap('%'||#{searchKeyword}||'%')))
							or (SPECIALDAY like '%'||#{searchKeyword}||'%')
							or (COLOR like initCap('%'||#{searchKeyword}||'%'))
							or (MATERIAL like initCap('%'||#{searchKeyword}||'%'))
							or (PRICE like initCap('%'||#{searchKeyword}||'%'))
							or (HEEL like initCap('%'||#{searchKeyword}||'%'))
							or (MODELID like initCap('%'||#{searchKeyword}||'%'))
			</foreach>
		</if>
	</select>
	
	<select id="getThirdCategory" parameterType="HashMap" resultType="shoes">
		SELECT * FROM shoess s, thirdCategory tc
			where s.thirdCategory = tc.thirdCategory
			<if test="thirdCategory == 1">
				and thirdCategoryClass = 1
			</if>
			<if test="thirdCategory == 2">
				and thirdCategoryClass = 2
			</if>
			<if test="thirdCategory == 3">
				and thirdCategoryClass = 3
			</if>
			<if test="thirdCategory == 4">
				and thirdCategoryClass = 4
			</if>
			<if test="thirdCategory == 5">
				and thirdCategoryClass = 5
			</if>
			<if test="thirdCategory == 6">
				and thirdCategoryClass = 6
			</if>
	</select>
	
	

</mapper>